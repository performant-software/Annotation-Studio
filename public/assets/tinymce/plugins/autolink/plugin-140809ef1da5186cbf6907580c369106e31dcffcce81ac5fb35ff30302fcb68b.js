!function(){"use strict";function o(e,t){if(t<0&&(t=0),3===e.nodeType){var n=e.data.length;n<t&&(t=n)}return t}function m(e,t,n){1!==t.nodeType||t.hasChildNodes()?e.setStart(t,o(t,n)):e.setStartBefore(t)}function y(e,t,n){1!==t.nodeType||t.hasChildNodes()?e.setEnd(t,o(t,n)):e.setEndAfter(t)}var n=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=tinymce.util.Tools.resolve("tinymce.Env"),k=function(e){return e.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)},p=function(e){return e.getParam("default_link_target",!1)},r=function(e,t,n){var o,i,r,a,f,s,d,l,c,u,g,h=k(e),C=p(e);if("A"!==e.selection.getNode().tagName){if((o=e.selection.getRng(!0).cloneRange()).startOffset<5){if(!(l=o.endContainer.previousSibling)){if(!o.endContainer.firstChild||!o.endContainer.firstChild.nextSibling)return;l=o.endContainer.firstChild.nextSibling}if(m(o,l,c=l.length),y(o,l,c),o.endOffset<5)return;i=o.endOffset,a=l}else{if(3!==(a=o.endContainer).nodeType&&a.firstChild){for(;3!==a.nodeType&&a.firstChild;)a=a.firstChild;3===a.nodeType&&(m(o,a,0),y(o,a,a.nodeValue.length))}i=1===o.endOffset?2:o.endOffset-1-t}for(r=i;m(o,a,2<=i?i-2:0),y(o,a,1<=i?i-1:0),i-=1," "!==(u=o.toString())&&""!==u&&160!==u.charCodeAt(0)&&0<=i-2&&u!==n;);(g=o.toString())!==n&&" "!==g&&160!==g.charCodeAt(0)?(0===o.startOffset?m(o,a,0):m(o,a,i),y(o,a,r)):(m(o,a,i),y(o,a,r),i+=1),"."===(s=o.toString()).charAt(s.length-1)&&y(o,a,r-1),(d=(s=o.toString().trim()).match(h))&&("www."===d[1]?d[1]="http://www.":/@$/.test(d[1])&&!/^mailto:/.test(d[1])&&(d[1]="mailto:"+d[1]),f=e.selection.getBookmark(),e.selection.setRng(o),e.execCommand("createlink",!1,d[1]+d[2]),!1!==C&&e.dom.setAttrib(e.selection.getNode(),"target",C),e.selection.moveToBookmark(f),e.nodeChanged())}},t=function(t){var e;t.on("keydown",function(e){13!==e.keyCode||r(t,-1,"")}),i.browser.isIE()?t.on("focus",function(){if(!e){e=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(n){}}}):(t.on("keypress",function(e){41!==e.keyCode||r(t,-1,"(")}),t.on("keyup",function(e){32!==e.keyCode||r(t,0,"")}))};!function e(){n.add("autolink",function(e){t(e)})}()}();