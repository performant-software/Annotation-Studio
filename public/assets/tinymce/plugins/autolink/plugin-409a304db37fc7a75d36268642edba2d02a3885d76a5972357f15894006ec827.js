!function(){"use strict";function t(t,e){if(e<0&&(e=0),3===t.nodeType){var n=t.data.length;n<e&&(e=n)}return e}function e(e,n,i){1!==n.nodeType||n.hasChildNodes()?e.setStart(n,t(n,i)):e.setStartBefore(n)}function n(e,n,i){1!==n.nodeType||n.hasChildNodes()?e.setEnd(n,t(n,i)):e.setEndAfter(n)}var i=tinymce.util.Tools.resolve("tinymce.PluginManager"),o=tinymce.util.Tools.resolve("tinymce.Env"),r=function(t){return t.getParam("autolink_pattern",/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i)},f=function(t){return t.getParam("default_link_target",!1)},a=function(t,i,o){var a,s,d,l,c,u,g,h,C,m,y=r(t),k=f(t);if("A"!==t.selection.getNode().tagName){if((a=t.selection.getRng(!0).cloneRange()).startOffset<5){if(!(h=a.endContainer.previousSibling)){if(!a.endContainer.firstChild||!a.endContainer.firstChild.nextSibling)return;h=a.endContainer.firstChild.nextSibling}if(e(a,h,C=h.length),n(a,h,C),a.endOffset<5)return;s=a.endOffset,l=h}else{if(3!==(l=a.endContainer).nodeType&&l.firstChild){for(;3!==l.nodeType&&l.firstChild;)l=l.firstChild;3===l.nodeType&&(e(a,l,0),n(a,l,l.nodeValue.length))}s=1===a.endOffset?2:a.endOffset-1-i}for(d=s;e(a,l,2<=s?s-2:0),n(a,l,1<=s?s-1:0),s-=1," "!==(m=a.toString())&&""!==m&&160!==m.charCodeAt(0)&&0<=s-2&&m!==o;);!function(t,e){return t===e||" "===t||160===t.charCodeAt(0)}(a.toString(),o)?(0===a.startOffset?e(a,l,0):e(a,l,s),n(a,l,d)):(e(a,l,s),n(a,l,d),s+=1),"."===(u=a.toString()).charAt(u.length-1)&&n(a,l,d-1),(g=(u=a.toString().trim()).match(y))&&("www."===g[1]?g[1]="http://www.":/@$/.test(g[1])&&!/^mailto:/.test(g[1])&&(g[1]="mailto:"+g[1]),c=t.selection.getBookmark(),t.selection.setRng(a),t.execCommand("createlink",!1,g[1]+g[2]),!1!==k&&t.dom.setAttrib(t.selection.getNode(),"target",k),t.selection.moveToBookmark(c),t.nodeChanged())}},s=function(t){var e;t.on("keydown",(function(e){if(13===e.keyCode)return function(t){a(t,-1,"")}(t)})),o.browser.isIE()?t.on("focus",(function(){if(!e){e=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(t){}}})):(t.on("keypress",(function(e){if(41===e.keyCode)return function(t){a(t,-1,"(")}(t)})),t.on("keyup",(function(e){if(32===e.keyCode)return function(t){a(t,0,"")}(t)})))};i.add("autolink",(function(t){s(t)}))}();