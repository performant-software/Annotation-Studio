!function(){"use strict";function e(e){return e&&1===e.nodeType&&"false"===e.contentEditable}function t(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function n(e){var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function r(e,n){var r,o=[];if((r=C.toArray(e.getBody().getElementsByTagName("span"))).length)for(var a=0;a<r.length;a++){var i=t(r[a]);null!==i&&i.length&&i===n.toString()&&o.push(r[a])}return o}function o(e,t,n){var o=t.get(),a=o.index,i=e.dom;(n=!1!==n)?a+1===o.count?a=0:a++:a-1==-1?a=o.count-1:a--,i.removeClass(r(e,o.index),"mce-match-marker-selected");var c=r(e,a);return c.length?(i.addClass(r(e,a),"mce-match-marker-selected"),e.selection.scrollIntoView(c[0]),a):-1}function a(e,t){var n=t.parentNode;e.remove(t),e.isEmpty(n)&&e.remove(n)}function i(e,t,n,r,a){var i=function(e,t){var n=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n]");return t?"\\b"+n+"\\b":n}(n,a),c=function(e,t,n){var r,o;return(o=e.dom.create("span",{"data-mce-bogus":1})).className="mce-match-marker",r=e.getBody(),S(e,t,!1),T.findAndReplaceDOMText(n,r,o,!1,e.schema)}(e,t,new RegExp(i,r?"g":"gi"));if(c){var u=o(e,t,!0);t.set({index:u,count:c,text:n,matchCase:r,wholeWord:a})}return c}function c(e,t){var n=o(e,t,!0);t.set(w(w({},t.get()),{index:n}))}function u(e,t){var n=o(e,t,!1);t.set(w(w({},t.get()),{index:n}))}function d(e){var n=t(e);return null!==n&&0<n.length}function s(e,r,o,i,s){var l,f,m,g,p,h=r.get(),x=h.index,v=x;for(i=!1!==i,m=e.getBody(),f=C.grep(C.toArray(m.getElementsByTagName("span")),d),l=0;l<f.length;l++){var y=t(f[l]);if(g=p=parseInt(y,10),s||g===h.index){for(o.length?(f[l].firstChild.nodeValue=o,n(f[l])):a(e.dom,f[l]);f[++l];){if((g=parseInt(t(f[l]),10))!==p){l--;break}a(e.dom,f[l])}i&&v--}else x<p&&f[l].setAttribute("data-mce-index",String(p-1))}return r.set(w(w({},h),{count:s?0:h.count-1,index:v})),i?c(e,r):u(e,r),!s&&0<r.get().count}function l(){}function f(e){return function(){return e}}function m(){return B}function g(e){return e.isNone()}function p(e){return e()}function h(e){return e}function x(e,t){return function(){R(e,t)}}var v,y,b=function(e){function t(){return n}var n=e;return{get:t,set:function(e){n=e},clone:function(){return b(t())}}},N=tinymce.util.Tools.resolve("tinymce.PluginManager"),w=function(){return(w=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},C=tinymce.util.Tools.resolve("tinymce.util.Tools"),T={findAndReplaceDOMText:function(t,n,r,o,a){function i(e,t){if(t=t||0,!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");var n=e.index;if(0<t){var r=e[t];if(!r)throw new Error("Invalid capture group");n+=e[0].indexOf(r),e[0]=r}return[n,n+e[0].length,[e[0]]]}var c,u,d,s,l,f,m=[],g=0;if(d=n.ownerDocument,s=a.getBlockElements(),l=a.getWhiteSpaceElements(),f=a.getShortEndedElements(),u=function t(n){var r;if(3===n.nodeType)return n.data;if(l[n.nodeName]&&!s[n.nodeName])return"";if(r="",e(n))return"\n";if((s[n.nodeName]||f[n.nodeName])&&(r+="\n"),n=n.firstChild)for(;r+=t(n),n=n.nextSibling;);return r}(n)){if(t.global)for(;c=t.exec(u);)m.push(i(c,o));else c=u.match(t),m.push(i(c,o));return m.length&&(g=m.length,function(t,n,r){var o,a,i,c,u=[],d=0,m=t,g=n.shift(),p=0;e:for(;;){if((s[m.nodeName]||f[m.nodeName]||e(m))&&d++,3===m.nodeType&&(!a&&m.length+d>=g[1]?(a=m,c=g[1]-d):o&&u.push(m),!o&&m.length+d>g[0]&&(o=m,i=g[0]-d),d+=m.length),o&&a){if(m=r({startNode:o,startNodeIndex:i,endNode:a,endNodeIndex:c,innerNodes:u,match:g[2],matchIndex:p}),d-=a.length-c,a=o=null,u=[],p++,!(g=n.shift()))break}else if(l[m.nodeName]&&!s[m.nodeName]||!m.firstChild){if(m.nextSibling){m=m.nextSibling;continue}}else if(!e(m)){m=m.firstChild;continue}for(;;){if(m.nextSibling){m=m.nextSibling;break}if(m.parentNode===t)break e;m=m.parentNode}}}(n,m,function(e){var t;if("function"!=typeof e){var n=e.nodeType?e:d.createElement(e);t=function(e,t){var r=n.cloneNode(!1);return r.setAttribute("data-mce-index",t),e&&r.appendChild(d.createTextNode(e)),r}}else t=e;return function(e){var n,r,o,a=e.startNode,i=e.endNode,c=e.matchIndex;if(a===i){var u=a;o=u.parentNode,0<e.startNodeIndex&&(n=d.createTextNode(u.data.substring(0,e.startNodeIndex)),o.insertBefore(n,u));var s=t(e.match[0],c);return o.insertBefore(s,u),e.endNodeIndex<u.length&&(r=d.createTextNode(u.data.substring(e.endNodeIndex)),o.insertBefore(r,u)),u.parentNode.removeChild(u),s}n=d.createTextNode(a.data.substring(0,e.startNodeIndex)),r=d.createTextNode(i.data.substring(e.endNodeIndex));for(var l=t(a.data.substring(e.startNodeIndex),c),f=0,m=e.innerNodes.length;f<m;++f){var g=e.innerNodes[f],p=t(g.data,c);g.parentNode.replaceChild(p,g)}var h=t(i.data.substring(0,e.endNodeIndex),c);return(o=a.parentNode).insertBefore(n,a),o.insertBefore(l,a),o.removeChild(a),(o=i.parentNode).insertBefore(h,i),o.insertBefore(r,i),o.removeChild(i),h}}(r))),g}}},S=function(e,r,o){var a,i,c,u,d=r.get();for(i=C.toArray(e.getBody().getElementsByTagName("span")),a=0;a<i.length;a++){var s=t(i[a]);null!==s&&s.length&&(s===d.index.toString()&&(c=c||i[a].firstChild,u=i[a].firstChild),n(i[a]))}if(r.set(w(w({},d),{index:-1,count:0,text:""})),c&&u){var l=e.dom.createRng();return l.setStart(c,0),l.setEnd(u,u.data.length),!1!==o&&e.selection.setRng(l),l}},O=function(e,t){return{done:function(n){return S(e,t,n)},find:function(n,r,o){return i(e,t,n,r,o)},next:function(){return c(e,t)},prev:function(){return u(e,t)},replace:function(n,r,o){return s(e,t,n,r,o)}}},A=f(!1),k=f(!0),B=(v={fold:function(e){return e()},is:A,isSome:A,isNone:k,getOr:h,getOrThunk:p,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:f(null),getOrUndefined:f(void 0),or:h,orThunk:p,map:m,each:l,bind:m,exists:A,forall:k,filter:m,equals:g,equals_:g,toArray:function(){return[]},toString:f("none()")},Object.freeze&&Object.freeze(v),v),I=function(e){function t(){return o}function n(t){return t(e)}var r=f(e),o={fold:function(t,n){return n(e)},is:function(t){return e===t},isSome:k,isNone:A,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:t,orThunk:t,map:function(t){return I(t(e))},each:function(t){t(e)},bind:n,exists:n,forall:n,filter:function(t){return t(e)?o:B},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(t){return t.is(e)},equals_:function(t,n){return t.fold(A,(function(t){return n(e,t)}))}};return o},E={some:I,none:m,from:function(e){return null==e?B:I(e)}},M=(y="function",function(e){return function(e){if(null===e)return"null";var t=typeof e;return"object"==t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t}(e)===y}),D=(Array.prototype.slice,M(Array.from)&&Array.from,tinymce.util.Tools.resolve("tinymce.Env")),R=function(e,t){function n(e){(!function(e,t){return 1<t.get().count}(0,t)?e.disable:e.enable)("next"),(function(e,t){return 1<t.get().count}(0,t)?e.enable:e.disable)("prev")}function r(e,t){!function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)}(["replace","replaceall","prev","next"],t?e.disable:e.enable)}function o(e,t){D.browser.isSafari()&&D.deviceType.isTouch()&&("find"===t||"replace"===t||"replaceall"===t)&&e.focus(t)}function a(o){S(e,t,!1),r(o,!0),n(o)}function d(o){var u=o.getData(),d=t.get();if(u.findtext.length){if(d.text===u.findtext&&d.matchCase===u.matchcase&&d.wholeWord===u.wholewords)c(e,t);else{var s=i(e,t,u.findtext,u.matchcase,u.wholewords);s<=0&&function(t){e.windowManager.alert("Could not find the specified string.",(function(){t.focus("findtext")}))}(o),r(o,0===s)}n(o)}else a(o)}var l=function(){var e=b(E.none());return{clear:function(){e.set(E.none())},set:function(t){e.set(E.some(t))},isSet:function(){return e.get().isSome()},on:function(t){e.get().each(t)}}}();e.undoManager.add();var f=C.trim(e.selection.getContent({format:"text"})),m=t.get(),g={title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",disabled:!0,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",disabled:!0,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",disabled:!0},{type:"custom",name:"replaceall",text:"Replace All",disabled:!0}],initialData:{findtext:f,replacetext:"",wholewords:m.wholeWord,matchcase:m.matchCase},onChange:function(e,n){"findtext"===n.name&&0<t.get().count&&a(e)},onAction:function(r,i){var l=r.getData();switch(i.name){case"find":d(r);break;case"replace":s(e,t,l.replacetext)?n(r):a(r);break;case"replaceall":s(e,t,l.replacetext,!0,!0),a(r);break;case"prev":u(e,t),n(r);break;case"next":c(e,t),n(r);break;case"matchcase":case"wholewords":!function(e){var n=e.getData(),r=t.get();t.set(w(w({},r),{matchCase:n.matchcase,wholeWord:n.wholewords}))}(r),a(r)}o(r,i.name)},onSubmit:function(e){d(e),o(e,"find")},onClose:function(){e.focus(),S(e,t),e.undoManager.add()}};l.set(e.windowManager.open(g,{inline:"toolbar"}))},F=function(e,t){e.addCommand("SearchReplace",(function(){R(e,t)}))},j=function(e,t){e.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:x(e,t),icon:"search"}),e.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:x(e,t),icon:"search"}),e.shortcuts.add("Meta+F","",x(e,t))};N.add("searchreplace",(function(e){var t=b({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1});return F(e,t),j(e,t),O(e,t)}))}();