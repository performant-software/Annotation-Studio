!function(e){"use strict";function n(){}function t(){return fe}function r(e){return e.isNone()}function o(e){return e()}function i(e){return e}function u(n,t){return s(e.document.createElement("canvas"),n,t)}function a(e){var n=u(e.width,e.height);return c(n).drawImage(e,0,0),n}function c(e){return e.getContext("2d")}function s(e,n,t){return e.width=n,e.height=t,e}function f(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],p(e,l(m,this),l(h,this))}function l(e,n){return function(){return e.apply(n,arguments)}}function d(e){var n=this;null!==this._state?ne((function(){var t=n._state?e.onFulfilled:e.onRejected;if(null!==t){var r;try{r=t(n._value)}catch(n){return void e.reject(n)}e.resolve(r)}else(n._state?e.resolve:e.reject)(n._value)})):this._deferreds.push(e)}function m(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void p(l(n,e),l(m,this),l(h,this))}this._state=!0,this._value=e,g.call(this)}catch(e){h.call(this,e)}}function h(e){this._state=!1,this._value=e,g.call(this)}function g(){for(var e=0,n=this._deferreds;e<n.length;e++){var t=n[e];d.call(this,t)}this._deferreds=[]}function v(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function p(e,n,t){var r=!1;try{e((function(e){r||(r=!0,n(e))}),(function(e){r||(r=!0,t(e))}))}catch(e){if(r)return;r=!0,t(e)}}function w(n){var t=n.src;return 0===t.indexOf("data:")?b(t):function(n){return new me((function(t,r){var o=new e.XMLHttpRequest;o.open("GET",n,!0),o.responseType="blob",o.onload=function(){200===this.status&&t(this.response)},o.onerror=function(){var e,n=this;r(0===this.status?((e=new Error("No access to download image")).code=18,e.name="SecurityError",e):new Error("Error "+n.status+" downloading image"))},o.send()}))}(t)}function y(n){return new me((function(t,r){function o(){c(),t(a)}function i(){c(),r("Unable to load data of type "+n.type+": "+u)}var u=e.URL.createObjectURL(n),a=new e.Image,c=function(){a.removeEventListener("load",o),a.removeEventListener("error",i)};a.addEventListener("load",o),a.addEventListener("error",i),a.src=u,a.complete&&o()}))}function b(n){return new me((function(t,r){(function(n){var t=n.split(","),r=/data:([^;]+)/.exec(t[0]);if(!r)return de.none();for(var o=r[1],i=t[1],u=e.atob(i),a=u.length,c=Math.ceil(a/1024),s=new Array(c),f=0;f<c;++f){for(var l=1024*f,d=Math.min(1024+l,a),m=new Array(d-l),h=l,g=0;h<d;++g,++h)m[g]=u[h].charCodeAt(0);s[f]=new Uint8Array(m)}return de.some(new e.Blob(s,{type:o}))})(n).fold((function(){r("uri is not base64: "+n)}),t)}))}function E(n,t,r){return t=t||"image/png",e.HTMLCanvasElement.prototype.toBlob?new me((function(e,o){n.toBlob((function(n){n?e(n):o()}),t,r)})):b(n.toDataURL(t,r))}function O(n){return y(n).then((function(n){!function(n){e.URL.revokeObjectURL(n.src)}(n);var t=u(function(e){return e.naturalWidth||e.width}(n),function(e){return e.naturalHeight||e.height}(n));return c(t).drawImage(n,0,0),t}))}function T(e,n,t){function r(n,t){return e.then((function(e){return function(e,n,t){return n=n||"image/png",e.toDataURL(n,t)}(e,n,t)}))}var o=n.type;return{getType:ae(o),toBlob:function(){return me.resolve(n)},toDataURL:function(){return t},toBase64:function(){return t.split(",")[1]},toAdjustedBlob:function(n,t){return e.then((function(e){return E(e,n,t)}))},toAdjustedDataURL:r,toAdjustedBase64:function(e,n){return r(e,n).then((function(e){return e.split(",")[1]}))},toCanvas:function(){return e.then(a)}}}function I(n){return function(n){return new me((function(t){var r=new e.FileReader;r.onloadend=function(){t(r.result)},r.readAsDataURL(n)}))}(n).then((function(e){return T(O(n),n,e)}))}function N(e,n){return E(e,n).then((function(n){return T(me.resolve(e),n,e.toDataURL())}))}function S(e,n){return e.toCanvas().then((function(t){return function(e,n,t){var r=u(e.width,e.height),o=c(r),i=0,a=0;return 90!==(t=t<0?360+t:t)&&270!==t||s(r,r.height,r.width),90!==t&&180!==t||(i=r.width),270!==t&&180!==t||(a=r.height),o.translate(i,a),o.rotate(t*Math.PI/180),o.drawImage(e,0,0),N(r,n)}(t,e.getType(),n)}))}function x(e,n){return e.toCanvas().then((function(t){return function(e,n,t){var r=u(e.width,e.height),o=c(r);return"v"===t?(o.scale(1,-1),o.drawImage(e,0,-r.height)):(o.scale(-1,1),o.drawImage(e,-r.width,0)),N(r,n)}(t,e.getType(),n)}))}function _(e){return I(e)}function R(e,n){for(var t=0,r=e.length;t<r;t++){var o=e[t];if(n(o,t))return de.some(o)}return de.none()}function A(e){return null!=e}function C(e){return"ImageProxy HTTP error: "+R(Te,(function(n){return e===n.code})).fold(ae("Unknown ImageProxy error"),(function(e){return e.message}))}function U(e){var n=C(e);return ge.reject(n)}function D(e){return R(Ie,(function(n){return n.type===e})).fold(ae("Unknown service error"),(function(e){return e.message}))}function L(e,n){return be(n).then((function(e){var n=function(e){var n=Oe(e),t=ye(n,["error","type"]);return"ImageProxy Service error: "+(t?D(t):"Invalid JSON in service error message")}(e);return ge.reject(n)}))}function k(e,n){var t={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":n};return Ee(function(e,n){var t=-1===e.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(e)||!n?e:e+t+"apiKey="+encodeURIComponent(n)}(e,n),t,!1).then((function(e){return e.status<200||300<=e.status?Ne(e.status,e.blob):ge.resolve(e.blob)}))}function j(e,n,t){return n?k(e,n):function(e,n){return Ee(e,{},n).then((function(e){return e.status<200||300<=e.status?Se(e.status):ge.resolve(e.blob)}))}(e,t)}function P(e,n){function t(e){return Number(n.replace(r,"$"+e))}var r=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}}(e,n);return r?_e(t(1),t(2)):{major:0,minor:0}}function M(e,n){return function(){return n===e}}function B(e,n){return function(){return n===e}}function F(e,n){var t=String(n).toLowerCase();return R(e,(function(e){return e.search(t)}))}function z(e,n){return-1!==e.indexOf(n)}function H(e){return function(n){return z(n,e)}}function q(e,n){return function(e,n){return R(e.dom().childNodes,(function(e){return n(Ge.fromDom(e))})).map(Ge.fromDom)}(e,(function(e){return function(e,n){var t=e.dom();if(t.nodeType!==Ye)return!1;var r=t;if(void 0!==r.matches)return r.matches(n);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(n);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(n);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")}(e,n)}))}function $(e){return q(Ge.fromDom(e),"img")}function X(e,n){return e.dom.is(n,"figure")}function W(e,n){e.notificationManager.open({text:n,type:"error"})}function G(e){var n=e.selection.getNode();return X(e,n)?$(n):de.some(Ge.fromDom(n))}function V(e,n){var t,r=n.src;return Qe(e,n)?j(n.src,null,function(e,n){return-1!==ue.inArray(function(e){return e.getParam("imagetools_credentials_hosts",[],"string[]")}(e),new ve(n.src).host)}(e,n)):Ke(e,n)?function(e){return w(e)}(n):(r=function(e){return e.getParam("imagetools_proxy")}(e),r+=(-1===r.indexOf("?")?"?":"&")+"url="+encodeURIComponent(n.src),t=function(e){return e.getParam("api_key",e.getParam("imagetools_api_key","","string"),"string")}(e),j(r,t,!1))}function Y(e,n){return function(e){return de.from(e.getParam("imagetools_fetch_image",null,"function"))}(e).fold((function(){return V(e,n)}),(function(e){return e(n)}))}function J(e,n){var t;return(t=e.editorUpload.blobCache.getByUri(n.src))?ge.resolve(t.blob()):Y(e,n)}function K(e){he.clearTimeout(e.get())}function Q(e,n,t,r,o,i){return n.toBlob().then((function(u){var a,c,s,f;return s=e.editorUpload.blobCache,a=o.src,function(e){return e.getParam("images_reuse_filename",!1,"boolean")}(e)&&(c=(f=s.getByUri(a))?(a=f.uri(),f.name()):function(e,n){var t=n.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return t?e.dom.encode(t[1]):null}(e,a)),f=s.create({id:"imagetools"+Je++,blob:u,base64:n.toBase64(),uri:a,name:c}),s.add(f),e.undoManager.transact((function(){e.$(o).on("load",(function n(){e.$(o).off("load",n),e.nodeChanged(),t?e.editorUpload.uploadImagesAuto():(K(r),function(e,n){var t=he.setEditorTimeout(e,(function(){e.editorUpload.uploadImagesAuto()}),function(e){return e.getParam("images_upload_timeout",3e4,"number")}(e));n.set(t)}(e,r))})),i&&e.$(o).attr({width:i.w,height:i.h}),e.$(o).attr({src:f.blobUri()}).removeAttr("data-mce-src")})),f}))}function Z(e,n,t,r){return function(){return G(e).fold((function(){W(e,"Could not find selected image")}),(function(o){return e._scanForImages().then((function(){return J(e,o.dom())})).then(_).then(t).then((function(t){return Q(e,t,!1,n,o.dom(),r)}),(function(n){W(e,n)}))}))}}var ee,ne,te,re,oe=function(e){function n(){return t}var t=e;return{get:n,set:function(e){t=e},clone:function(){return oe(n())}}},ie=tinymce.util.Tools.resolve("tinymce.PluginManager"),ue=tinymce.util.Tools.resolve("tinymce.util.Tools"),ae=function(e){return function(){return e}},ce=ae(!1),se=ae(!0),fe=(ee={fold:function(e){return e()},is:ce,isSome:ce,isNone:se,getOr:i,getOrThunk:o,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:ae(null),getOrUndefined:ae(void 0),or:i,orThunk:o,map:t,each:n,bind:t,exists:ce,forall:se,filter:t,equals:r,equals_:r,toArray:function(){return[]},toString:ae("none()")},Object.freeze&&Object.freeze(ee),ee),le=function(e){function n(){return o}function t(n){return n(e)}var r=ae(e),o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:se,isNone:ce,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:n,orThunk:n,map:function(n){return le(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?o:fe},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(ce,(function(n){return t(e,n)}))}};return o},de={some:le,none:t,from:function(e){return null==e?fe:le(e)}},me=window.Promise?window.Promise:(ne=f.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(n){e.setTimeout(n,1)},te=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},f.prototype.catch=function(e){return this.then(null,e)},f.prototype.then=function(e,n){var t=this;return new f((function(r,o){d.call(t,new v(e,n,r,o))}))},f.all=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var t=Array.prototype.slice.call(1===e.length&&te(e[0])?e[0]:e);return new f((function(e,n){function r(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,(function(e){r(i,e)}),n)}t[i]=u,0==--o&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var o=t.length,i=0;i<t.length;i++)r(i,t[i])}))},f.resolve=function(e){return e&&"object"==typeof e&&e.constructor===f?e:new f((function(n){n(e)}))},f.reject=function(e){return new f((function(n,t){t(e)}))},f.race=function(e){return new f((function(n,t){for(var r=0,o=e;r<o.length;r++)o[r].then(n,t)}))},f),he=tinymce.util.Tools.resolve("tinymce.util.Delay"),ge=tinymce.util.Tools.resolve("tinymce.util.Promise"),ve=tinymce.util.Tools.resolve("tinymce.util.URI"),pe={getImageSize:function(e){function n(e){return/^[0-9\.]+px$/.test(e)}var t,r;return t=e.style.width,r=e.style.height,t||r?n(t)&&n(r)?{w:parseInt(t,10),h:parseInt(r,10)}:null:(t=e.width,r=e.height,t&&r?{w:parseInt(t,10),h:parseInt(r,10)}:null)},setImageSize:function(e,n){var t,r;n&&(t=e.style.width,r=e.style.height,(t||r)&&(e.style.width=n.w+"px",e.style.height=n.h+"px",e.removeAttribute("data-mce-style")),t=e.width,r=e.height,(t||r)&&(e.setAttribute("width",n.w),e.setAttribute("height",n.h)))},getNaturalImageSize:function(e){return{w:e.naturalWidth,h:e.naturalHeight}}},we=(re="function",function(e){return function(e){if(null===e)return"null";var n=typeof e;return"object"==n&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":n}(e)===re}),ye=(Array.prototype.slice,we(Array.from)&&Array.from,function(e,n){var t;return t=n.reduce((function(e,n){return A(e)?e[n]:void 0}),e),A(t)?t:null}),be=function(n){return new ge((function(t){var r=new e.FileReader;r.onload=function(e){var n=e.target;t(n.result)},r.readAsText(n)}))},Ee=function(n,t,r){return new ge((function(o){var i;(i=new e.XMLHttpRequest).onreadystatechange=function(){4===i.readyState&&o({status:i.status,blob:this.response})},i.open("GET",n,!0),i.withCredentials=r,ue.each(t,(function(e,n){i.setRequestHeader(n,e)})),i.responseType="blob",i.send()}))},Oe=function(e){var n;try{n=JSON.parse(e)}catch(e){}return n},Te=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],Ie=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}],Ne=function(e,n){return function(e){return 400===e||403===e||500===e}(e)?L(0,n):U(e)},Se=U,xe=function(){return _e(0,0)},_e=function(e,n){return{major:e,minor:n}},Re={nu:_e,detect:function(e,n){var t=String(n).toLowerCase();return 0===e.length?xe():P(e,t)},unknown:xe},Ae="Firefox",Ce=function(e){var n=e.current;return{current:n,version:e.version,isEdge:M("Edge",n),isChrome:M("Chrome",n),isIE:M("IE",n),isOpera:M("Opera",n),isFirefox:M(Ae,n),isSafari:M("Safari",n)}},Ue={unknown:function(){return Ce({current:void 0,version:Re.unknown()})},nu:Ce,edge:ae("Edge"),chrome:ae("Chrome"),ie:ae("IE"),opera:ae("Opera"),firefox:ae(Ae),safari:ae("Safari")},De="Windows",Le="Android",ke="Solaris",je="FreeBSD",Pe=function(e){var n=e.current;return{current:n,version:e.version,isWindows:B(De,n),isiOS:B("iOS",n),isAndroid:B(Le,n),isOSX:B("OSX",n),isLinux:B("Linux",n),isSolaris:B(ke,n),isFreeBSD:B(je,n)}},Me={unknown:function(){return Pe({current:void 0,version:Re.unknown()})},nu:Pe,windows:ae(De),ios:ae("iOS"),android:ae(Le),linux:ae("Linux"),osx:ae("OSX"),solaris:ae(ke),freebsd:ae(je)},Be=function(e,n){return F(e,n).map((function(e){var t=Re.detect(e.versionRegexes,n);return{current:e.name,version:t}}))},Fe=function(e,n){return F(e,n).map((function(e){var t=Re.detect(e.versionRegexes,n);return{current:e.name,version:t}}))},ze=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,He=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return z(e,"edge/")&&z(e,"chrome")&&z(e,"safari")&&z(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,ze],search:function(e){return z(e,"chrome")&&!z(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return z(e,"msie")||z(e,"trident")}},{name:"Opera",versionRegexes:[ze,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:H("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:H("firefox")},{name:"Safari",versionRegexes:[ze,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(z(e,"safari")||z(e,"mobile/"))&&z(e,"applewebkit")}}],qe=[{name:"Windows",search:H("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return z(e,"iphone")||z(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:H("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:H("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:H("linux"),versionRegexes:[]},{name:"Solaris",search:H("sunos"),versionRegexes:[]},{name:"FreeBSD",search:H("freebsd"),versionRegexes:[]}],$e={browsers:ae(He),oses:ae(qe)},Xe=oe(function(e,n){var t=$e.browsers(),r=$e.oses(),o=Be(t,e).fold(Ue.unknown,Ue.nu),i=Fe(r,e).fold(Me.unknown,Me.nu);return{browser:o,os:i,deviceType:function(e,n,t,r){var o=e.isiOS()&&!0===/ipad/i.test(t),i=e.isiOS()&&!o,u=e.isiOS()||e.isAndroid(),a=u||r("(pointer:coarse)"),c=o||!i&&u&&r("(min-device-width:768px)"),s=i||u&&!c,f=n.isSafari()&&e.isiOS()&&!1===/safari/i.test(t),l=!s&&!c&&!f;return{isiPad:ae(o),isiPhone:ae(i),isTablet:ae(c),isPhone:ae(s),isTouch:ae(a),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:ae(f),isDesktop:ae(l)}}(i,o,e,n)}}(e.navigator.userAgent,(function(n){return e.window.matchMedia(n).matches}))),We=function(e){if(null==e)throw new Error("Node cannot be null or undefined");return{dom:ae(e)}},Ge={fromHtml:function(n,t){var r=(t||e.document).createElement("div");if(r.innerHTML=n,!r.hasChildNodes()||1<r.childNodes.length)throw e.console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return We(r.childNodes[0])},fromTag:function(n,t){var r=(t||e.document).createElement(n);return We(r)},fromText:function(n,t){var r=(t||e.document).createTextNode(n);return We(r)},fromDom:We,fromPoint:function(e,n,t){var r=e.dom();return de.from(r.elementFromPoint(n,t)).map(We)}},Ve=(e.Node.ATTRIBUTE_NODE,e.Node.CDATA_SECTION_NODE,e.Node.COMMENT_NODE,e.Node.DOCUMENT_NODE,e.Node.DOCUMENT_TYPE_NODE,e.Node.DOCUMENT_FRAGMENT_NODE,e.Node.ELEMENT_NODE),Ye=(e.Node.TEXT_NODE,e.Node.PROCESSING_INSTRUCTION_NODE,e.Node.ENTITY_REFERENCE_NODE,e.Node.ENTITY_NODE,e.Node.NOTATION_NODE,Ve),Je=(Xe.get().browser.isIE(),void 0!==e.window?e.window:Function("return this;")(),0),Ke=function(e,n){var t=n.src;return 0===t.indexOf("data:")||0===t.indexOf("blob:")||new ve(t).host===e.documentBaseURI.host},Qe=function(e,n){return-1!==ue.inArray(function(e){return e.getParam("imagetools_cors_hosts",[],"string[]")}(e),new ve(n.src).host)},Ze=function(e,n,t){return function(){var r=G(e).fold((function(){return null}),(function(e){var n=pe.getImageSize(e.dom());return n?{w:n.h,h:n.w}:null}));return Z(e,n,(function(e){return function(e,n){return S(e,n)}(e,t)}),r)()}},en=function(e,n,t){return function(){return Z(e,n,(function(e){return function(e,n){return x(e,n)}(e,t)}))()}},nn=function(e,n){function t(n){return function(n){return e.dom.is(n,"img:not([data-mce-object],[data-mce-placeholder])")}(n)&&(Ke(e,n)||Qe(e,n)||e.settings.imagetools_proxy)}return X(e,n)?$(n).map((function(e){return t(e.dom())?de.some(e.dom()):de.none()})):t(n)?de.some(n):de.none()},tn=K,rn=J,on=G,un=function(n,t,r,o,i){return new ge((function(){(function(e){return y(e)})(i).then((function(n){var t=pe.getNaturalImageSize(n);return o.w===t.w&&o.h===t.h||pe.getImageSize(r)&&pe.setImageSize(r,t),e.URL.revokeObjectURL(n.src),i})).then(_).then((function(e){return Q(n,e,!0,t,r)}),(function(){}))}))},an=ae("save-state"),cn=ae("disable"),sn=ae("enable"),fn=function(n,t){return function(){var r=on(n),o=r.map((function(e){return pe.getNaturalImageSize(e.dom())}));on(n).each((function(i){nn(n,i.dom()).each((function(){rn(n,i.dom()).then((function(i){var u=function(n){return{blob:n,url:e.URL.createObjectURL(n)}}(i);n.windowManager.open(function(e){return{title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:e}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(e){var i=e.getData().imagetools.blob;r.each((function(e){o.each((function(r){un(n,t,e.dom(),r,i)}))})),e.close()},onCancel:function(){},onAction:function(e,n){switch(n.name){case an():n.value?e.enable("save"):e.disable("save");break;case cn():e.disable("save"),e.disable("cancel");break;case sn():e.enable("cancel")}}}}(u))}))}))}))}},ln=function(e,n){ue.each({mceImageRotateLeft:Ze(e,n,-90),mceImageRotateRight:Ze(e,n,90),mceImageFlipVertical:en(e,n,"v"),mceImageFlipHorizontal:en(e,n,"h"),mceEditImage:fn(e,n)},(function(n,t){e.addCommand(t,n)}))},dn=function(e,n,t){e.on("NodeChange",(function(r){var o=t.get();o&&o.src!==r.element.src&&(tn(n),e.editorUpload.uploadImagesAuto(),t.set(null)),nn(e,r.element).each(t.set)}))},mn=function(e){function n(n){return function(){return e.execCommand(n)}}e.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:n("mceImageRotateLeft")}),e.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:n("mceImageRotateRight")}),e.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:n("mceImageFlipVertical")}),e.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:n("mceImageFlipHorizontal")}),e.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:n("mceEditImage"),onSetup:function(n){function t(){on(e).each((function(t){var r=nn(e,t.dom()).isNone();n.setDisabled(r)}))}return e.on("NodeChange",t),function(){e.off("NodeChange",t)}}}),e.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image-options",onAction:n("mceImage")}),e.ui.registry.addContextMenu("imagetools",{update:function(t){return nn(e,t).fold((function(){return[]}),(function(){return[{text:"Edit image",icon:"edit-image",onAction:n("mceEditImage")}]}))}})},hn=function(e){e.ui.registry.addContextToolbar("imagetools",{items:function(e){return e.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions")}(e),predicate:function(n){return nn(e,n).isSome()},position:"node",scope:"node"})};ie.add("imagetools",(function(e){var n=oe(0),t=oe(null);ln(e,n),mn(e),hn(e),dn(e,n,t)}))}(window);